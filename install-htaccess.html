<html>
<head>
	<meta charset="utf-8">
	<title>Install - htaccess</title>
	
	<link rel="stylesheet" type="text/css" href="etc/install/theme/buttons.css">
	<link rel="stylesheet" type="text/css" href="etc/install/theme/style.css">
	
	<style>
	
		#wrapper {
			width: 800px;
		}
		
		#refresh {
			float: right;
			margin-right: 10px;
		}
	
	</style>
	
	<script src="etc/libs/jquery.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="etc/libs/mustache.min.js" type="text/javascript" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" href="etc/notifications.css" />
	<script src="etc/notifications.js" type="text/javascript" charset="utf-8"></script>
	
</head>
<body>
	
	<div id="wrapper">
		
		<p>Copy and paste this code into the <code>.htaccess</code> file in the CCMS root directory.</p>
		
		<p>It was generated using <code>config.json</code>, when you change the <code>database</code> property in <code>config.json</code>, you have to update <code>.htaccess</code> too.</p>
		
		<p>If you haven't changed the default <code>config.json</code> file, you can omit updating <code>.htaccess</code>.</p>
	
		<pre id="htaccess">loading ...</pre>

<pre id="htaccess-template" style="display: none;"># ccms
Options -Multiviews
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} -f [OR] # file
RewriteCond %{REQUEST_FILENAME} -d [OR]
RewriteCond %{REQUEST_FILENAME} -l
RewriteRule ^ - [L]
RewriteRule _root/(.*)$ $1 [L] # root everywhere
RewriteRule ^couchdb/_session/(.*)$ http://127.0.0.1:5984/_session/$1 [P,L] # couchdb proxy
RewriteRule ^couchdb/_config/admins/(.*)$ http://127.0.0.1:5984/_config/admins/$1 [P,L]
RewriteRule ^couchdb/{{database}}/(.*)$ http://127.0.0.1:5984/{{database}}/$1 [P,L]
RewriteRule ^install$ install.html [L] # install
RewriteRule ^install/.*$ install.html [L]
RewriteRule ^admin$ admin.html [L] # admin
RewriteRule ^admin/.*$ admin.html [L]
RewriteRule ^ index.html [L] # blog
# ccms end</pre>

		<script>
				
			$.ajax({
				url: 'config.json',
				dataType: 'json',
				success: function (config) {
					var code = Mustache.render($('#htaccess-template').text(), config);
					$('#htaccess').text(code);
				},
				error: function (jqXHR, textStatus, errorThrown) {
					notifications.alert('Error <code>' + textStatus + ' ' + errorThrown + '</code> occured while loading <code>' + this.url + '</code>.');
					$('#htaccess').text('error');
				}
			});
			
		</script>
		
		<p>You may also have to enable the Apache modules <code>rewrite</code>, <code>proxy</code> and <code>proxy_http</code>. <code>AllowOverride All</code> is also required for the CCMS root directory.</p>

		<a href="install-config.html"><button class="grey previous">Previous</button></a>
		<a href="install"><button class="next">Did it</button></a>
		<a href=""><button id="refresh" class="grey">Refresh</button></a>
	
	</div> <!-- #wrapper -->
	
</body>
</html>