var CouchDB=function(b,e,g,a){this.proxyPath=b;this.database=e;var c=false;if(typeof g!=="undefined"&&typeof a!=="undefined"){c=true}var d=function(i,h){i.url=b+"/"+e+"/"+i.document;i.document=null;i.data=JSON.stringify(i.data);if(c&&i.type!=="GET"&&i.type!=="HEAD"){i.beforeSend=function(k){k.setRequestHeader("Authorization","Basic "+btoa(g+":"+a))}}var j=$.ajax(i);j.done(h);j.fail(function(k,m,l){h(null,m,k)})};this.read=function(h,i){d({document:h,type:"GET"},function(k,l,j){i(JSON.parse(k),f(j))})};this.exists=function(h,i){d({document:h,type:"HEAD"},function(k,l,j){if(j.status===200){i(j.getResponseHeader("Etag").replace(/"/g,""),f(j))}else{i(false,f(j))}})};this.view=function(i,h,j){d({document:"_design/"+i+"/_view/"+h,type:"GET"},function(l,m,k){j(JSON.parse(l),f(k))})};if(c){this.save=function(h,i,j){d({document:h,type:"HEAD"},function(m,n,l){var k=l.status;if(k===200){i._rev=l.getResponseHeader("Etag").replace(/"/g,"")}if(k===404||k===200){d({document:h,type:"PUT",data:i},function(p,q,o){j(JSON.parse(p),f(o))})}else{j(JSON.parse(i),f(l))}})};this.remove=function(h,i){d({document:h,type:"HEAD",},function(k,l,j){if(j.status===200){d({document:h+"?rev="+j.getResponseHeader("Etag").replace(/"/g,""),type:"DELETE"},function(n,o,m){i(JSON.parse(n),f(m))})}else{i(null,f(j))}})}}function f(i){var h=i.status;if(h!==200&&h!==201){return{code:h,message:i.statusText}}else{return false}}};var ccmsVersion="0.0.1";function copyrightYearsString(b,a){if(b===a){return b+""}else{if(b<a){return b+" - "+a}else{if(b>a){console.log("Copyright years start > end, I'll fix that.",b,a);return a+" - "+b}else{console.log("Copyright years are invalid.",b,a)}}}}function updateCopyrightYears(b){var a=parseInt(moment().format("YYYY"));b.read("meta",function(f,d){if(d){console.log('Error while reading document "meta".',d)}else{var e=a<f.copyrightYearsStart,c=a>f.copyrightYearsEnd;if(e||c){if(e){f.copyrightYearsStart=a}else{f.copyrightYearsEnd=a}f.copyrightYears=copyrightYearsString(f.copyrightYearsStart,f.copyrightYearsEnd);b.save("meta",f,function(g,h){if(h){console.log("Error.",h)}})}}})}var Template=function(){var g=function(){var i=document.URL;if(/#.+$/.test(i)){i=i.replace(/^.*#/,"").replace(/\/$/,"");if(i===""){i="/"}}else{i="/"}return i};var b=[];var d={};var e=function(i,o,k){var p=function(t){var q="";var s=t.length;for(var r=0;r<s;r++){q+=t[r]||""}return q};k(g());var j={};if(i.length>0){var m=[];var l=$("body");var n=function(){l.html(p(m));var q=true;if(m.length!==i.length){q=false}else{for(var r=m.length;r--;){if(typeof m[r]!=="string"){q=false}}}if(q){o(j,g())}};$.each(i,function(s,r){var q=d[r];var u=$('script[type="text/ccms-template"][data-template-id="'+r+'"]').html();var t=typeof q;if(q===null){t="null"}switch(t){case"function":q(function(v){m[s]=Mustache.render(u,v);j[r]=v;n()},g());break;case"object":m[s]=Mustache.render(u,q);j[r]=q;n();break;default:m[s]=u;j[r]={};n();break}})}else{o(j,g())}};var f=function(){var m=g();for(var k=b.length;k--;){var j=b[k];var o=j.path;var l=typeof o;if(o instanceof RegExp){l="regexp"}var n=function(){e(j.templateIDs,j.done,j.before);k=0};switch(l){case"string":if(o==m){n()}break;case"regexp":if(o.test(m)){n()}break;case"function":if(o(m)){n()}break}}};var c=function(l,i,j,k){if(i==null){i=[]}if(typeof j==="undefined"||j==null){j=function(){}}if(typeof k==="undefined"){k=function(){}}b.push({path:l,templateIDs:i,done:j,before:k})};var a=function(j,i){d[j]=i};if("onhashchange" in window){window.onhashchange=function(){f()}}else{var h=window.location.hash;window.setInterval(function(){if(window.location.hash!=h){h=window.location.hash;f()}},100)}this.load=f;this.route=c;this.render=a;this.currentPath=g};