function render(b,d,c){b.render("header",c);b.render("footer",c);var e=[];b.render("index",function(o,q){var i=c.postsPerPage,l;if(q==="/"){l=0}else{l=parseInt(q.replace(/^\/page\//,""),10)}var n=i*l;var p=[],j=true;for(var h=n;h<n+i;h++){var m=e[h];if(typeof m==="undefined"){j=false}p.push(m)}function f(k){this.previousPage=function(){if(l===0){return false}else{return{number:l-1}}};this.nextPage=function(){if(k.length!==i){return false}else{return{number:l+1}}};this.posts=k}if(!j){var g="all?descending=true&skip="+n+"&limit="+i;d.view("posts",g,function(k,s){if(s){console.log('Error while getting view "'+g+'" of design document "posts".',s)}var u=[];var v=k.rows;for(var t=v.length;t--;){u[t]=v[t].value}for(var r=u.length;r--;){e[n+r]=u[r]}o(new f(u))})}else{o(new f(p))}});var a={};b.render("post",function(l,k){var f=k.replace(/^\/post\//,"");if(a[f]!=null){l(a[f]);return}else{var g=null;for(var j=e.length;j--;){if(e[j].postID==f){g=j;j=0}}if(g!==null){var h=e[g];a[f]=h;l(h)}else{d.read("post-"+f,function(i,m){if(m){console.log('Error while getting view "'+func+'" of design document "posts".',m)}a[f]=i;l(i)})}}})}function setRoutes(a,c,b){a.route("/",["header","index","footer"],function(){document.title=b.title});a.route(/^\/post\/.+$/,["header","post","footer"],function(d){document.title=b.title+" - "+d.post.title});a.route(/^\/page\/\d+$/,["header","index","footer"],function(d){document.title=b.title},function(d){if(d==="/page/0"){window.location="#/"}})}$(document).ready(function(){$.ajax({url:"config.json"}).done(function(a){var b=new Template();var c=new CouchDB(a.couchdbProxy,a.database);c.read("meta",function(e,d){if(d){console.log('Error while loading document "meta".',d)}else{render(b,c,e);setRoutes(b,c,e);b.load()}})})});