$(document).ready(function(){var c=[{path:"/",templates:["header.html","posts.html","footer.html"],before:function(a,b){if(b.page==1){window.open(theme.host+theme.rootPath+theme.sitePath);return false}},title:"{{header_html.title}}"},{path:/^\/posts\/.+$/,templates:["header.html","post.html","footer.html"],title:"{{header_html.title}} - {{post_html.title}}"}];function d(b,a){var f={};f["header.html"]={data:a};f["footer.html"]={data:a};f["head.html"]={data:a};f["posts.html"]={load:function(e,n,o){var q=a.postsPerPage,p=parseInt(o.page||1),r=p-1;skip=q*r;b.view("posts","byDate?descending=true&skip="+skip+"&limit="+q,function(g,j){if(j){e(null,{title:j.message,heading:"HTTP Error",message:"The error <code>"+j.code+" "+j.message+"</code> occured while loading the posts."})}else{var h=[];for(var i=0;i<g.rows.length;i++){h.push(g.rows[i].value)}b.view("posts","compactByDate?descending=true&skip="+(skip+q)+"&limit=1",function(u,l){if(l){e(null,{title:l.message,heading:"HTTP Error",message:"The error <code>"+l.code+" "+l.message+"</code> occured."})}else{var k={posts:h,hasNext:u.rows.length?true:false};var v=new m(r,k);e(v)}})}});function m(g,h){this.previousPage=function(){if(g==0){return false}else{return{number:p-1}}};this.nextPage=function(){if(h.hasNext){return{number:p+1}}else{return false}};this.posts=h.posts}},cache:{initial:[],read:function(e,k,m){var n=parseInt(m.page||1)-1;var l=e["posts.html"][n];if(l){return l}return null},save:function(m,l,e,k){var n=parseInt(k.page||1)-1;l[n]=m;return l}}};f["post.html"]={load:function(e,j,k){var l=j.replace(/^\/posts\//,"");b.view("posts",'byPostID?key="'+l+'"',function(h,g){if(g){e(null,{title:g.message,heading:"HTTP Error",message:"The error <code>"+g.code+" "+g.message+"</code> occured."})}else{if(!h.rows.length){e(null,{title:"Not Found",heading:"Post not found",message:"The post you were looking for wasn't found. Go back <a href=\""+theme.rootPath+theme.sitePath+'">home</a>.'})}else{e(h.rows[0].value)}}})},cache:{initial:{},read:function(s,e,i){var r=e.replace(/^\/posts\//,"");if(s["post.html"][r]){return s["post.html"][r]}var t=s["posts.html"];for(var p=t.length;p--;){var j=t[p].posts;for(var q=j.length;q--;){if(j[q].postID==r){return j[q]}}}return null},save:function(m,l,e,k){var n=e.replace(/^\/posts\//,"");l[n]=m;return l}}};return f}$.ajax({url:"_root/config.json",dataType:"json",error:function(f,a,b){fatalError("Ajax Error","Error <code>"+a+" "+b+"</code> occured while loading <code>"+this.url+"</code>.")},success:function(a){couchdb=new CouchDB(a.root+"/couchdb");database=new couchdb.Database(a.database);database.read("meta",function(b,f){if(f){fatalError("CouchDB Error","Error <code>"+f.code+" "+f.message+"</code> occured while loading loading document <code>meta</code>.")}else{window.createTheme({rootPath:a.root,sitePath:"",filePath:"/themes/"+b.theme,routes:c,views:d(database,b),cache:{views:true,templates:true}})}})}})});