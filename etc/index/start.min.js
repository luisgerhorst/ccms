$(document).ready(function(){var b=[{path:"/",templates:["header.html","posts.html","footer.html"],before:function(d,c){if(c.page==1){window.open(theme.host+theme.rootPath+theme.sitePath);return false}},title:"{{{header_html.title}}}"},{path:/^\/posts\/.+$/,templates:["header.html","post.html","footer.html"],title:"{{{header_html.title}}} - {{{post_html.title}}}"}];function a(d,e){var c={};c["header.html"]={data:e};c["footer.html"]={data:e};c["head.html"]={data:e};c["posts.html"]={load:function(l,j,i){var g=e.postsPerPage,h=parseInt(i.page||1),f=h-1;skip=g*f;d.view("posts","byDate?descending=true&skip="+skip+"&limit="+g,function(m,n){if(n){l(null,{title:n.message,heading:"HTTP Error",message:"The error <code>"+n.code+" "+n.message+"</code> occured while loading the posts."})}else{var p=[];for(var o=0;o<m.rows.length;o++){p.push(m.rows[o].value)}d.view("posts","compactByDate?descending=true&skip="+(skip+g)+"&limit=1",function(r,s){if(s){l(null,{title:s.message,heading:"HTTP Error",message:"The error <code>"+s.code+" "+s.message+"</code> occured."})}else{var t={posts:p,hasNext:r.rows.length?true:false};var q=new k(f,t);l(q)}})}});function k(m,n){this.previousPage=function(){if(m==0){return false}else{return{number:h-1}}};this.nextPage=function(){if(n.hasNext){return{number:h+1}}else{return false}};this.posts=n.posts}},cache:{initial:[],read:function(j,i,g){var f=parseInt(g.page||1)-1;var h=j["posts.html"][f];if(h){return h}return null},save:function(g,h,j,i){var f=parseInt(i.page||1)-1;h[f]=g;return h}}};c["post.html"]={load:function(i,h,g){var f=h.replace(/^\/posts\//,"");d.view("posts",'byPostID?key="'+f+'"',function(j,k){if(k){i(null,{title:k.message,heading:"HTTP Error",message:"The error <code>"+k.code+" "+k.message+"</code> occured."})}else{if(!j.rows.length){i(null,{title:"Not Found",heading:"Post not found",message:"The post you were looking for wasn't found. Go back <a href=\""+theme.rootPath+theme.sitePath+'">home</a>.'})}else{i(j.rows[0].value)}}})},cache:{initial:{},read:function(o,m,l){var f=m.replace(/^\/posts\//,"");if(o["post.html"][f]){return o["post.html"][f]}var n=o["posts.html"];for(var h=n.length;h--;){var k=n[h].posts;for(var g=k.length;g--;){if(k[g].postID==f){return k[g]}}}return null},save:function(g,h,j,i){var f=j.replace(/^\/posts\//,"");h[f]=g;return h}}};return c}$.ajax({url:"_root/config.json",dataType:"json",error:function(c,e,d){fatalError("Ajax Error","Error <code>"+e+" "+d+"</code> occured while loading <code>"+this.url+"</code>.")},success:function(c){couchdb=new CouchDB(c.root+"/couchdb");database=new couchdb.Database(c.database);database.read("meta",function(e,d){if(d){fatalError("CouchDB Error","Error <code>"+d.code+" "+d.message+"</code> occured while loading loading document <code>meta</code>.")}else{window.createTheme({rootPath:c.root,sitePath:"",filePath:"/themes/"+e.theme,routes:b,views:a(database,e),cache:{views:true,templates:true}})}})}})});